{
  "projectName": "opencode-visual-toolkit-storyboard",
  "description": "Add storyboard video generation feature using Veo 3.1 with native audio, multi-scene support, transitions, and video stitching capabilities.",
  "branchName": "ralph/storyboard-video",
  "repository": "48Nauts-Operator/opencode-nanobanana",
  "techStack": {
    "runtime": "Bun",
    "language": "TypeScript",
    "framework": "OpenCode Plugin",
    "dependencies": [
      "@google/genai",
      "@opencode-ai/plugin",
      "sharp",
      "zod"
    ],
    "externalTools": [
      "ffmpeg"
    ]
  },
  "userStories": [
    {
      "id": "VEO3-001",
      "title": "Upgrade to Veo 3.1 API",
      "description": "Update GeminiProvider to use Veo 3.1 model with native audio support and new features.",
      "priority": 1,
      "acceptanceCriteria": [
        "Update generateVideo() to use model 'veo-3.1-generate-001'",
        "Add support for native audio generation (enabled by default)",
        "Add resolution option: '720p' or '1080p' (default: '720p')",
        "Add duration option: 4, 6, or 8 seconds (default: 8)",
        "Update animateImage() to use Veo 3.1",
        "Add generateAudio config option to enable/disable audio",
        "Update tests for new Veo 3.1 parameters",
        "Verify audio is included in generated videos"
      ],
      "passes": true
    },
    {
      "id": "VEO3-002",
      "title": "Video Extension API Support",
      "description": "Add support for Veo 3.1 video extension feature to extend existing videos with new content.",
      "priority": 2,
      "acceptanceCriteria": [
        "Add extendVideo(videoBuffer, prompt, options) method to GeminiProvider",
        "Method takes existing video and extends it with new prompt",
        "Returns extended video buffer",
        "Supports same options as generateVideo (aspectRatio, resolution)",
        "Handles API polling for long-running operation",
        "Add unit test for extendVideo method"
      ],
      "passes": true
    },
    {
      "id": "VEO3-003",
      "title": "Reference Image Support",
      "description": "Add support for Veo 3.1 reference images feature to guide video generation with up to 3 reference images.",
      "priority": 3,
      "acceptanceCriteria": [
        "Add generateVideoWithReferences(prompt, referenceImages[], options) method",
        "referenceImages is array of {buffer, description} objects (max 3)",
        "Reference images guide character/object/scene consistency",
        "Returns video buffer with content matching references",
        "Add unit test for reference image feature"
      ],
      "passes": true
    },
    {
      "id": "FFMPEG-001",
      "title": "FFmpeg Utility Module",
      "description": "Create FFmpeg utility module for video processing operations.",
      "priority": 4,
      "acceptanceCriteria": [
        "Create src/utils/ffmpeg.ts utility module",
        "checkFfmpegInstalled() returns boolean",
        "concatenateVideos(videoPaths[], outputPath, transition) stitches videos",
        "Transition options: 'cut', 'crossfade', 'fade'",
        "transitionDuration parameter for crossfade/fade (default: 0.5s)",
        "getVideoDuration(videoPath) returns duration in seconds",
        "trimVideo(videoPath, startTime, duration, outputPath) trims video",
        "addAudioTrack(videoPath, audioPath, outputPath) adds background music",
        "All functions return Promise and handle errors gracefully",
        "Add unit tests with mocked ffmpeg commands"
      ],
      "passes": true
    },
    {
      "id": "STORY-001",
      "title": "Storyboard Video Tool - Core",
      "description": "Implement generate_storyboard_video tool that generates multiple scenes and stitches them together.",
      "priority": 5,
      "acceptanceCriteria": [
        "Create src/tools/video/storyboard-video.ts",
        "Tool accepts scenes[] array of scene description strings",
        "Tool accepts style option to prefix all scenes (e.g., 'cinematic', 'commercial')",
        "Tool accepts aspectRatio option (default: '16:9')",
        "Tool accepts transition option: 'cut', 'crossfade', 'fade' (default: 'crossfade')",
        "Tool accepts transitionDuration option (default: 0.5)",
        "Tool accepts outputPath option",
        "Generates all scenes in parallel for speed",
        "Uses FFmpeg to stitch scenes with transitions",
        "Returns path to final combined video",
        "Handles errors for individual scenes gracefully"
      ],
      "passes": true
    },
    {
      "id": "STORY-002",
      "title": "Storyboard Character Consistency",
      "description": "Add character consistency feature to storyboard tool using style prefix and reference images.",
      "priority": 6,
      "acceptanceCriteria": [
        "Add characterDescription option to storyboard tool",
        "Character description is prepended to each scene prompt",
        "Add referenceImages option (array of image paths)",
        "Reference images are used with Veo 3.1 reference feature",
        "Character appears consistent across all scenes",
        "Add example in tool description showing character consistency usage"
      ],
      "passes": true
    },
    {
      "id": "STORY-003",
      "title": "Storyboard Audio Options",
      "description": "Add audio control options to storyboard tool.",
      "priority": 7,
      "acceptanceCriteria": [
        "Add generateAudio option (default: true) to enable/disable native Veo audio",
        "Add backgroundMusic option (path to audio file)",
        "Background music is mixed with native audio if both enabled",
        "Add musicVolume option (0.0-1.0, default: 0.3) for background music level",
        "FFmpeg handles audio mixing",
        "Final video has properly mixed audio track"
      ],
      "passes": true
    },
    {
      "id": "STORY-004",
      "title": "Storyboard Progress Callback",
      "description": "Add progress reporting for long-running storyboard generation.",
      "priority": 8,
      "acceptanceCriteria": [
        "Tool logs progress for each scene generation",
        "Format: 'Generating scene 1/5...' etc.",
        "Logs when stitching begins",
        "Logs total generation time at completion",
        "Returns detailed result with per-scene timing"
      ],
      "passes": true
    },
    {
      "id": "EXTEND-001",
      "title": "Extend Video Tool",
      "description": "Implement extend_video tool that extends an existing video with new content.",
      "priority": 9,
      "acceptanceCriteria": [
        "Create src/tools/video/extend-video.ts",
        "Tool accepts videoPath (required) - path to existing video",
        "Tool accepts prompt (required) - description of extension content",
        "Tool accepts outputPath (optional)",
        "Uses Veo 3.1 video extension API",
        "Returns path to extended video",
        "Add tool to plugin exports"
      ],
      "passes": true
    },
    {
      "id": "TEST-001",
      "title": "Storyboard Integration Tests",
      "description": "Add integration tests for storyboard video generation.",
      "priority": 10,
      "acceptanceCriteria": [
        "Create tests/video/storyboard.test.ts",
        "Test multi-scene generation with mocked Veo API",
        "Test FFmpeg stitching with mocked commands",
        "Test transition options (cut, crossfade, fade)",
        "Test character consistency with style prefix",
        "Test error handling for failed scenes",
        "All tests pass"
      ],
      "passes": true
    },
    {
      "id": "DOCS-001",
      "title": "Update README with Storyboard Documentation",
      "description": "Document the new storyboard video generation feature in README.",
      "priority": 11,
      "acceptanceCriteria": [
        "Add Storyboard Video section to README",
        "Document generate_storyboard_video tool parameters",
        "Document extend_video tool parameters",
        "Add example usage for multi-scene video",
        "Add example usage for character consistency",
        "Add example usage for background music",
        "Document FFmpeg requirement",
        "Update feature list at top of README"
      ],
      "passes": true
    },
    {
      "id": "UPDATE-001",
      "title": "Update Existing Video Tools for Veo 3.1",
      "description": "Update generate_video and image_to_video tools to use Veo 3.1 and expose new options.",
      "priority": 12,
      "acceptanceCriteria": [
        "Update generate_video tool to use Veo 3.1",
        "Add resolution parameter (720p/1080p)",
        "Add duration parameter (4/6/8 seconds)",
        "Add generateAudio parameter (default: true)",
        "Update image_to_video tool similarly",
        "Update tool descriptions to mention audio support",
        "Update README video tools section"
      ],
      "passes": false
    }
  ]
}
